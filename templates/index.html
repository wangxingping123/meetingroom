{% load staticfiles %}
<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <title>Title</title>

    <link rel="stylesheet" href="/static/bootstrap-3.3.7-dist/css/bootstrap.min.css">
    <link rel="stylesheet" href="{% static "datetimepicker/bootstrap-datetimepicker.min.css" %}">
    <style>

        table tr td{
            width: 100px;height: 100px;
        }
        .room{background-color: yellow}

    </style>

</head>
<body>

<div class="container">
    <h2>会议室预定</h2>
    <div class="input-append date form_datetime pull-right" >
    <input size="20" class="reserve_time" type="text"  value="{{ current_time }}" readonly>
    <span class="add-on"><i class="icon-remove"></i></span>
    <span class="add-on"><i class="icon-calendar"></i></span>
        <button class="btn btn-primary" id="btn_save">预约</button>
    </div>
    <table class="table table-bordered">
        <thead >
        <tr>
            <th>会议室</th>
            {% for time in time_slot %}
            <th>{{ time.1 }}</th>
            {% endfor %}
        </tr>
        </thead>
        <tbody>
        {% for i,v in room_dic.items %}
        <tr room_id="{{ i }}">
        <td>{{ v.name }}</td>
        {% for i,v in v.info.items %}
        <td choice="{{ i }}">{{ v }}</td>
        {% endfor %}

        </tr>
        {% endfor %}


        </tbody>
    </table>


</div>
<script src="/static/jquery-3.2.1.min.js"></script>
<script src="/static/jquery.cookie.js"></script>
<script src="{% static "datetimepicker/bootstrap-datetimepicker.min.js" %}"></script>
<script src="{% static "datetimepicker/bootstrap-datetimepicker.zh-CN.js" %}"></script>
<script type="text/javascript">

    var time=new Date();
    var currernt_time=time.toLocaleDateString();

    $(".form_datetime").datetimepicker({
        format: "yyyy-mm-dd",
        autoclose: true,
        minView:2,
        todayBtn: true,
        startDate:currernt_time ,
        minuteStep: 10,

    });
</script>

<script>




    //给所有的td标签添加点击事件
    $("td").click(function () {
        if ($(this).text() == 'None'){
            $(this).toggleClass("room")
        }
    });

    //给预约按钮添加点击事件用ajax发送请求到后端处理
    $("#btn_save").click(function () {
        var data_list=[];
        $(".room").each(function () {
            var this_tag=$(this);
            var data_dic={"room_id":this_tag.parent().attr("room_id"),
            "time_slot":this_tag.attr("choice"),"reserve_time":$(".reserve_time").val()};
            data_list.push(data_dic)
        });

        $.ajax({
            url:"/index/",
            type:"POST",
            headers:{"X-CSRFToken":$.cookie('csrftoken')},
            contentType:"json",
            data:JSON.stringify(data_list),
            success:function (data) {
                var data=JSON.parse(data);
                if(data["flag"]){
                    alert("预约成功")
                }else {
                    alert("数据库异常")
                }

            }

        });

        console.log(data_list)


    })


</script>

</body>
</html>